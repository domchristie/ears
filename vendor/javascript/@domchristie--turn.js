function t(){return!function(){if("undefined"!=typeof window){const r=window.matchMedia("(prefers-reduced-motion: reduce)");return!r||r.matches}return!0}()}function e(r){return r.split(/[^\w]/).map(((r,d)=>0===d?r.toLowerCase():i(r))).join("")}function i(r){return r.replace(/^\w/,(r=>r.toUpperCase()))}class n{static supported=!0;exit(){}async beforeEnter(){}async enter(){}complete(){}abort(){}finished=Promise.resolve()}class s{constructor(r){this.selector=r,this.ended=new Promise((r=>{this.resolve=r}))}async start(r){r();[...document.querySelectorAll(this.selector)].every((r=>r.getAnimations().length))?(await function(r){const d=[...document.querySelectorAll(r)];return Promise.all(d.map((r=>new Promise((d=>{r.addEventListener("animationend",(function i(){r.removeEventListener("animationend",i),d()}))})))))}(this.selector),this.resolve()):this.resolve()}}const r={animateRestore:!1};class a{constructor(d,m={}){this.action=d,this.options={...r,...m},this.beforeExitClasses=new Set,this.exitClasses=new Set,this.enterClasses=new Set,this.beforeTransitionClasses=new Set,this.transitionClasses=new Set}addClasses(r){document.documentElement.classList.add(`turn-${r}`),Array.from(document.querySelectorAll(`[data-turn-${r}]`)).forEach((d=>{var m;d.dataset[`turn${m=r,m.split(/[^\w]/).map(i).join("")}`].split(/\s+/).forEach((m=>{m&&(d.classList.add(m),this[`${e(r)}Classes`].add(m))}))}))}removeClasses(r){document.documentElement.classList.remove(`turn-${r}`),Array.from(document.querySelectorAll(`[data-turn-${r}]`)).forEach((d=>{this[`${e(r)}Classes`].forEach((r=>d.classList.remove(r)))}))}dispatch(r,{target:d=document,detail:m={},bubbles:w=!0,cancelable:f=!0}={}){const p=`turn:${r}`,v=new window.CustomEvent(p,{detail:m,bubbles:w,cancelable:f});return d.dispatchEvent(v),v}}class o extends a{static supported=!0;exit(r){const d=new s("[data-turn-exit]");let m;this.animateOut=Promise.all([d.ended,new Promise((r=>{m=r}))]),this.addClasses("before-exit"),this.dispatch("before-exit",{detail:r}),window.requestAnimationFrame((()=>{d.start((()=>this.addClasses("exit"))),this.removeClasses("before-exit"),m()}))}async beforeEnter(r){await this.animateOut,this.removeClasses("exit"),this.animateIn?await this.animateIn:this.dispatch("before-enter",{detail:{...r,action:this.action}})}enter(){const r=new s("[data-turn-enter]");return this.animateIn=r.ended,r.start((()=>this.addClasses("enter"))),this.animateIn}async complete(r){this.removeClasses("enter"),this.dispatch("enter",{detail:{...r,action:this.action}})}abort(){this.removeClasses("before-exit"),this.removeClasses("exit"),this.removeClasses("enter")}get finished(){return this.animateIn}}class c extends a{static supported=!!document.startViewTransition;prepare(){return this.snapshot=new Promise((r=>{this.snapshat=r})),this.transition=document.startViewTransition((r=>this.render())),this.snapshot}exit(){}async beforeEnter(r){this.addClasses("before-transition"),this.dispatch("before-transition",{detail:{...r,action:this.action}}),await this.prepare()}render(){return this.snapshat(),new Promise((r=>{this.rendered=r}))}async enter(){this.rendered(),this.removeClasses("before-transition"),this.addClasses("transition"),await this.finished,await Promise.resolve(),this.removeClasses("transition")}complete(){}abort(){this.removeClasses("transition")}rendered(){}get finished(){return this.transition?.finished}}const d=["advance","restore","replace"];class h{constructor(r){this.config=r}start(){var r;this.animationTurn=new n,this.viewTransitionTurn=new n,r=this.config,document.documentElement.classList.add(c.supported&&r.experimental.viewTransitions?"turn-view-transitions":"turn-no-view-transitions"),this.currentUrl=window.location.toString()}stop(){this.animationTurn.abort(),this.viewTransitionTurn.abort(),this.animationTurn=new n,this.viewTransitionTurn=new n,document.documentElement.classList.remove(c.supported?"turn-view-transitions":"turn-no-view-transitions"),delete this.initiator,delete this.currentUrl}click(r){this.initiator=r.target}submitStart(r){this.initiator=r.target}visit(r){this.reset(r),this.animationTurn=u(o,r.detail.action),this.config.experimental.viewTransitions&&(this.viewTransitionTurn=u(c,r.detail.action)),this.animationTurn.exit({...r.detail,referrer:this.currentUrl,initiator:this.initiator})}async beforeRender(r){r.preventDefault();const d={newBody:r.detail.newBody,referrer:this.currentUrl,initiator:this.initiator};await this.animationTurn.beforeEnter(d),this.hasPreview?await this.viewTransitionTurn.finished:await this.viewTransitionTurn.beforeEnter(d),this.isPreview&&(this.hasPreview=!0),r.detail.resume()}render(){this.currentUrl=window.location.toString(),delete this.initiator;(this.isPreview||!this.hasPreview)&&(this._render=this.viewTransitionTurn.enter().then((()=>this.animationTurn.enter())))}async load(r){await this._render,l(),this.animationTurn.complete({...r.detail,referrer:this.currentUrl})}popstate(r){"restore"!==this.animationTurn.action&&this.animationTurn.abort()}get isPreview(){return document.documentElement.hasAttribute("data-turbo-preview")}reset(r){var d;l(),d=r.detail.action,document.documentElement.classList.add(`turn-${d}`),this.hasPreview=void 0,this._render=void 0,this.animationTurn.abort(),this.viewTransitionTurn.abort(),"restore"!==r.detail.action&&this.initiator||(this.initiator=document.documentElement)}}function l(){const r=document.documentElement.classList;r.remove.apply(r,d.map((r=>`turn-${r}`)))}function u(r,d){r.supported&&"false"!==document.body.dataset.turn||(r=n);return new r(d,JSON.parse(document.body.dataset.turnOptions||"{}"))}const m={start(){if(!this.started&&t()){for(const r in w)window.addEventListener(r,w[r]);this.controller=new h(m.config),this.controller.start(),this.started=!0}},stop(){if(this.started){for(const r in w)window.removeEventListener(r,w[r]);this.controller.stop(),this.started=!1}},config:{experimental:{viewTransitions:!1}}},w={"turbo:click":function(r){this.controller.click(r)}.bind(m),"turbo:visit":function(r){this.controller.visit(r)}.bind(m),"turbo:submit-start":function(r){this.controller.submitStart(r)}.bind(m),"turbo:before-render":async function(r){this.controller.beforeRender(r)}.bind(m),"turbo:render":async function(){this.controller.render()}.bind(m),"turbo:load":async function(r){this.controller.load(r)}.bind(m),popstate:function(){this.controller.popstate()}.bind(m)};export{m as default};

