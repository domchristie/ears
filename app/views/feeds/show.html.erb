<% @title = @feed.title %>

<% content_for :nav do %>
  <%= render "nav", class: "group fixed", data: {layout_target: "respondable", active_when: "banner:invisible"} do %>
    <div class="absolute inset-0 opacity bg-frosted-glass bg-gradient-to-b from-white dark:from-black -translate-y-full group-data-active:translate-y-0 opacity-0 group-data-active:opacity-100 transition duration-300">
      <%= link_to image_tag(ExternalImage.url(@feed.image_url), width: 48, height: 48, alt: "", class: "absolute top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2 motion-safe:turn-enter:animate-enter-fade motion-safe:turn-exit:animate-exit-fade"), "#top", data: {action: "layout#scrollToTop:prevent"} %>
    </div>
    <%= render "back", path: root_path, color: :translucent_black %>
  <% end %>
<% end %>

<%= render "header", image: ExternalImage.url(@feed.image_url), title: @feed.title do |p| %>
  <% p.content_for :meta do %>
    <p><%= @feed.author %></p>
  <% end %>
<% end %>

<div class="mt-fl-xs">
  <%= render "container", tag: :search do %>
    <%= form_with url: feed_path(@feed), method: :get, data: {turbo_frame: :entries, turbo_action: :replace, controller: "live-search", live_search_target: "form"}, class: "group px-px sm:px-0 -mx-fl-xs-lg sm:mx-0" do |form| %>
      <fieldset class="flex items-center">
        <div class="relative flex-1">
          <%= icon :search, solid: true, class: "w-5 h-5 absolute top-1/2 left-2 -translate-y-1/2 text-grey-500 dark:text-grey-400 pointer-events-none", aria_hidden: true %>
          <%= form.label :query, "Search", class: "sr-only" %>
          <%= form.search_field :query, ui.text_input(size: :sm).merge(value: params[:query], class: "pl-8", data: {live_search_target: "input", action: "live-search#search live-search#setQuery"}) %>
        </div>
        <div data-live-search-target="cancel" class="overflow-hidden transition-[width] group-data-[query]:w-[var(--width)] group-data-[query='']:!w-0">
          <%= link_to "Cancel", feed_path(@feed), data: {turbo_frame: :entries, turbo_action: :replace, action: "live-search#cancel"}, class: "px-fl-2xs" %>
        </div>
      </fieldset>
    <% end %>
  <% end %>

  <%= turbo_frame_tag :entries, class: "block relative py-fl-2xs" do %>
    <div class="<%= class_names ["space-y-fl-3xs", {"min-h-[50vh]": params[:query]}] %>">
      <%= render(partial: "feeds/episode", collection: @episodes) || render("empty") do %>
        <%= params[:query].present? ? "No results" : "No episodes" %>
      <% end %>
    </div>
  <% end %>
</div>
